{% extends "stears/writers_base_test.html" %}
{% load stears_tags %}
{% block page_title_block %}
{% endblock %}
{% block nav_block %}
	{% include 'stears/writers_nav.html' %}
{% endblock %}
{% block writers_block %}
	<br>
	<br>
	<div class="row">
		<div class="columns small-12 small-centered">
			<div class="row">
				<div class="columns small-12 large-9">
					<div class="fill" id="comment_area" style="padding-left:15px;padding-right:15px;" {% if comment_form.errors %}{% else %}hidden{% endif %}>
						<div class="row">
							{% for field in comment_form %}
								{% if field.errors %}
									<h3 style="color:#FF4747;">
									{{ field.errors }}
									</h3>
								{% endif %}
							{% endfor %}
							{% include 'stears/comment_form.html' %}
						</div>
						<br>
					</div>
					<br>
					<div class="fill" id="keyword_area" style="padding-left:15px;padding-right:15px;" {% if key_words_form.errors %}{% else %}hidden{% endif %}>
						<div class="row">
							{% for field in key_words_form %}
								{% if field.errors %}
									<h3 style="color:#FF4747;">
									{{ field.errors }}
									</h3>
								{% endif %}
							{% endfor %}
							{% if article.keywords %}
							<h3>
								Present key words: 
							</h3>
							<p>
								{% for word in article.keywords %}
								{{ word }}, 
								{% endfor%}
							</p>
							{% endif %}
							{% include 'stears/keywords_form.html' %}
						</div>
						<br>
					</div>
					<div class="fill" style="padding-left:15px;padding-right:15px;">
						{% if article.writer %}
							{% if user.username|can_write:article %}
								<div class="row">
									<dl class="accordion" data-accordion>
										<dd class="accordion-navigation">
										<a href="#panel1" class="shadowbox article_box" style="background-color:white;">
											<strong>
											Write/Edit this article?
											</strong>
										</a>
										<br>
										<div id="panel1" class="content">
											{% include 'stears/write_form.html' %}
										</div>
										</dd>
									</dl>
								</div>
							{% else %}
								<div class="row">
									<div class="home_box">
										<strong>
										Sorry, you can't edit this article
										</strong>
									</div>
								</div>
							{% endif %}
						{% else %}
							<div class="row">
								<dl class="accordion" data-accordion>
									<dd class="accordion-navigation">
									<a href="#panel1" class="shadowbox article_box" style="background-color:white;">
										<strong>
										Write this article?
										</strong>
									</a>
									<div id="panel1" class="content" >
										{% include 'stears/write_form.html' %}
									</div>
									</dd>
								</dl>
							</div>
							{% include "stears/nse_versions.html" %}
						{% endif %}
					</div>
					<br>
					<div>
						<table>
							<tr >
								<td>
									Headline
								</td>
								<td>
									{{ article.headline }}
								</td>
							</tr>
							{% if article.writer %}
								<tr>
									<td>
										related NSE article
									</td>
									<td>
										{% if article.nse_article_id != '0' %}
											<a href="{% url 'stears:article_detail' pk=article.nse_article_id %}">{{ article.nse_article_id|get_headline }}</a>
										{% else %}
											No related nse data point
										{% endif %}
									</td>
								</tr>
							{% endif %}
							<tr>
								<td>
									Content
								</td>
								<td>
									{{ article.content|linebreaks }}
								</td>
							</tr>
							<tr>
								<td>
									Category
								</td>
								<td>
									{{ article.category }}
								</td>
							</tr>
							<tr>
								<td>
									Writer
								</td>
								<td>
									{% if article.writer %}
										{% if user.username|is_editor %}
											<a href="{% url 'stears:writer_detail' article.writer %}">
												{{ article.writer }}
											</a>
										{% else %}
											{{ article.writer }}
										{% endif %}
									{% endif %}
								</td>
							</tr>
							<tr>
								<td>
									Status
								</td>
								<td>
									<strong>
									{{ article.state }}
									</strong>
								</td>
							</tr>
						</table>
					</div>
				</div>
				
				<div class="columns small-12 large-3">
					<br>
					<div class="row">
						<div class="home_box columns small-12 small-centered" style="max-width:400px;">
							<strong>
							Options
							</strong>
							<br>
							<br>
							<div class="row">
								<button id="comment_area_button" style="border-radius:3px;" class=" fill">Comment</button>
							</div>
							{% if user.username|is_editor %}
								{% if article.writer %}
									<div class="row">
										<form action="{% url 'stears:delete_article' %}" method="post" id="delete">
											{% csrf_token %}
											<button type="submit" class="fill delete" name="article_id" value="{{ article.article_id }}">Delete</button>
										</form>
									</div>
								{% endif%}
							{% endif %}
							{% if user.username|can_suggest:article %}
								<div class="row">
									<form action="{% url 'stears:suggest_nse_article' %}" method="post" id="assign">
										{% csrf_token %}
										{{ suggest_form }}
										<button type="submit" class="fill" name="article_id" value="{{ article.article_id }}">Suggest</button>
									</form>
								</div>
							{% endif %}
							{% if user.username|is_editor %}
								{% ifequal article.state 'submitted' %}
									<div class="row">
										<form action="{% url 'stears:approve_article' %}" method="post" id="approve">
											{% csrf_token %}
											<button type="submit" class="fill" name="commit_id" value="{{ article.article_id }}">Approve</button>
										</form>
									</div>
									<div class="row">
										<form action="{% url 'stears:approve_article' %}" method="post" id="reject">
											{% csrf_token %}
											<button type="submit" class="fill" name="reject_id" value="{{ article.article_id }}">Reject</button>
										</form>
									</div>
								{% endifequal %}
								{% ifequal article.visible False %}
									<div class="row">
										<p>
										<strong>
										{{ article.writer }} can write this article as {{ article.category }}?
										</strong>
										</p>
									</div>
									<div class="row">
										<div class="columns small-6">
											<form action="{% url 'stears:accept_article' %}" method="post" id="accept">
												{% csrf_token %}
												<button type="submit" class="fill" name="accept_id" value="{{ article.article_id }}">Yes</button>
											</form>
										</div>
										<div class="columns small-6">
											<form action="{% url 'stears:accept_article' %}" method="post" id="accept">
												{% csrf_token %}
												<button type="submit" class="fill" name="not_accept_id" value="{{ article.article_id }}">No</button>
											</form>
										</div>
									</div>
								{% endifequal %}
							{% endif %}
							<div class="row">
								<button id="keyword_area_button" style="border-radius:3px;" class=" fill">View/Edit keywords</button>
							</div>
						</div>
					</div>
				</div>
				
			</div>
			<br>
			<div class="row">
				<div class="columns small-12 large-9">
					<div class="fill" style="padding-left:15px;padding-right:15px;">
						{% if article.comments %}
							<h3>
							Comments
							</h3>
							<br>
							{% for comment in article.comments %}
								{% include 'stears/comment_button.html' %}
								<br>
							{% endfor %}
							<br>
							<br>
							<br>
							<br>
							<br>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}